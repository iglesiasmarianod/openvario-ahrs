#
# Makefile for eMPL Linux userland implementation
#

CC = gcc
CFLAGS = -Wall



MPUDIR = mpu9150
EMPLDIR = ${MPUDIR}/eMPL
GLUEDIR = ${MPUDIR}/glue
TMPSENSDIR = .
SENSORD_REAL_PATH = .

GIT_VERSION := $(shell cd $(SENSORD_REAL_PATH); git describe --dirty)

# add -DI2C_DEBUG for debugging
DEFS = -DEMPL_TARGET_LINUX -DMPU9150 -DAK8975_SECONDARY -DVERSION_GIT=\"$(GIT_VERSION)\"


OBJS = inv_mpu.o \
       inv_mpu_dmp_motion_driver.o \
       linux_glue.o \
       mpu9150.o \
       quaternion.o \
       vector3d.o

OBJS_SENSORCAL = $(OBJS) 24c16.o ams5915.o

OBJS_SENSORD = $(OBJS) ms5611.o ams5915.o ads1110.o nmea.o timer.o KalmanFilter1d.o cmdline_parser.o configfile_parser.o vario.o AirDensity.o 24c16.o

all : sensorcal sensord

sensorcal : $(OBJS_SENSORCAL) sensorcal.o
	$(CC) $(CFLAGS) $(OBJS_SENSORCAL) sensorcal.o -lrt -lm -o sensorcal
	
sensord : $(OBJS_SENSORD) main.o
	$(CC) $(CFLAGS) $(OBJS_SENSORD) main.o -lrt -lm -o sensord
	

## --------- TEMP SCAFFOLD -----------------

sensorcal.o : $(TMPSENSDIR)/sensorcal.c $(TMPSENSDIR)/def.h
	$(CC) $(CFLAGS) -I $(EMPLDIR) -I $(GLUEDIR) -I $(MPUDIR) -c $(TMPSENSDIR)/sensorcal.c
	
24c16.o : $(TMPSENSDIR)/24c16.c
	$(CC) $(CFLAGS) $(DEFS) -c $(TMPSENSDIR)/24c16.c
	
ams5915.o : $(TMPSENSDIR)/ams5915.c
	$(CC) $(CFLAGS) $(DEFS) -c $(TMPSENSDIR)/ams5915.c
	
ms5611.o : $(TMPSENSDIR)/ms5611.c
	$(CC) $(CFLAGS) $(DEFS) -c $(TMPSENSDIR)/ms5611.c
	
ads1110.o : $(TMPSENSDIR)/ads1110.c
	$(CC) $(CFLAGS) $(DEFS) -c $(TMPSENSDIR)/ads1110.c
	
main.o : $(TMPSENSDIR)/main.c
	$(CC) $(CFLAGS) $(DEFS) -I $(EMPLDIR) -I $(GLUEDIR) -I $(MPUDIR) -c $(TMPSENSDIR)/main.c
	
nmea.o : $(TMPSENSDIR)/nmea.c
	$(CC) $(CFLAGS) $(DEFS) -c $(TMPSENSDIR)/nmea.c
	
timer.o : $(TMPSENSDIR)/timer.c
	$(CC) $(CFLAGS) $(DEFS) -c $(TMPSENSDIR)/timer.c
	
KalmanFilter1d.o : $(TMPSENSDIR)/KalmanFilter1d.c
	$(CC) $(CFLAGS) $(DEFS) -c $(TMPSENSDIR)/KalmanFilter1d.c
	
cmdline_parser.o : $(TMPSENSDIR)/cmdline_parser.c
	$(CC) $(CFLAGS) $(DEFS) -c $(TMPSENSDIR)/cmdline_parser.c
	
configfile_parser.o : $(TMPSENSDIR)/configfile_parser.c
	$(CC) $(CFLAGS) $(DEFS) -c $(TMPSENSDIR)/configfile_parser.c
	
vario.o : $(TMPSENSDIR)/vario.c
	$(CC) $(CFLAGS) $(DEFS) -c $(TMPSENSDIR)/vario.c
	
AirDensity.o : $(TMPSENSDIR)/AirDensity.c
	$(CC) $(CFLAGS) $(DEFS) -c $(TMPSENSDIR)/AirDensity.c
	
## --------- END TEMP SCAFFOLD


mpu9150.o : $(MPUDIR)/mpu9150.c
	$(CC) $(CFLAGS) $(DEFS) -I $(EMPLDIR) -I $(GLUEDIR) -c $(MPUDIR)/mpu9150.c

quaternion.o : $(MPUDIR)/quaternion.c
	$(CC) $(CFLAGS) $(DEFS) -c $(MPUDIR)/quaternion.c

vector3d.o : $(MPUDIR)/vector3d.c
	$(CC) $(CFLAGS) $(DEFS) -c $(MPUDIR)/vector3d.c

linux_glue.o : $(GLUEDIR)/linux_glue.c
	$(CC) $(CFLAGS) $(DEFS) -I $(EMPLDIR) -I $(GLUEDIR) -c $(GLUEDIR)/linux_glue.c

inv_mpu_dmp_motion_driver.o : $(EMPLDIR)/inv_mpu_dmp_motion_driver.c
	$(CC) $(CFLAGS) $(DEFS) -I $(EMPLDIR) -I $(GLUEDIR) -c $(EMPLDIR)/inv_mpu_dmp_motion_driver.c

inv_mpu.o : $(EMPLDIR)/inv_mpu.c
	$(CC) $(CFLAGS) $(DEFS) -I $(EMPLDIR) -I $(GLUEDIR) -c $(EMPLDIR)/inv_mpu.c

clean:
	rm -f *.o sensorcal sensord

veryclean: clean
	rm -f sensorcal sensord
